<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MIDI Orchestra Visualizer</title>
  <link rel="stylesheet" href="style.css?v=20260217d">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <!-- コントロールパネル -->
  <div id="controls">
    <div class="control-group file-inputs">
      <div id="midiDropZone" class="file-row">
        <span class="file-label">MIDI</span>
        <input type="file" id="midiInput" accept=".mid,.midi">
        <span id="midiFileName">未選択（ドロップ可）</span>
        <button class="library-btn" data-slot="midi">ライブラリ</button>
        <button id="midiClearBtn" class="clear-btn" style="display:none;"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div id="audioDropZone" class="file-row">
        <span class="file-label">音源</span>
        <input type="file" id="audioInput" accept="audio/*">
        <span id="audioFileName">未選択（ドロップ可）</span>
        <button class="library-btn" data-slot="audio">ライブラリ</button>
        <button id="audioClearBtn" class="clear-btn" style="display:none;"><i class="fa-solid fa-xmark"></i></button>
      </div>
    </div>
    <div class="control-group sync-controls">
      <div class="sync-row">
        <label>MIDI遅延</label>
        <input type="range" id="midiDelay" min="-2" max="3" step="0.05" value="0">
        <span id="midiDelayValue">0.00秒</span>
      </div>
      <div class="sync-row">
        <label>音源遅延</label>
        <input type="range" id="audioDelay" min="-2" max="3" step="0.05" value="0">
        <span id="audioDelayValue">0.00秒</span>
      </div>
    </div>
    <div class="control-group playback-group">
      <div class="control-group">
        <button id="rewBtn"><i class="fa-solid fa-backward"></i></button>
        <button id="playBtn" disabled><i class="fa-solid fa-play"></i></button>
        <button id="stopBtn" disabled><i class="fa-solid fa-stop"></i></button>
        <button id="ffBtn"><i class="fa-solid fa-forward"></i></button>
        <select id="aspectRatioSelect" style="margin-left:auto;">
          <option value="16:9">16:9</option>
          <option value="9:16">9:16</option>
          <option value="free">フリー</option>
        </select>
      </div>
      <div class="control-group seek-group">
        <label><span id="currentTime">0:00</span> <span id="editorDuration">/ 0:00</span></label>
        <div class="seek-bar-container">
          <input type="range" id="editorSeek" min="0" max="100" step="0.1" value="0">
          <input type="range" id="loopStartSeek" min="0" max="1000" step="1" value="0" class="loop-start-range">
          <input type="range" id="loopEndSeek" min="0" max="1000" step="1" value="1000" class="loop-end-range">
        </div>
        <div class="loop-end-block">
          <label class="loop-end-label"><input type="checkbox" id="loopStartEnabled"> 始点 <span id="loopStartTime">-:--.--</span> <span class="loop-end-btns"><button id="loopStartUp" class="loop-end-btn">▲</button><button id="loopStartDown" class="loop-end-btn">▼</button></span></label>
          <label class="loop-end-label"><input type="checkbox" id="loopEndEnabled"> 終点 <span id="loopEndTime">-:--.--</span> <span class="loop-end-btns"><button id="loopEndUp" class="loop-end-btn">▲</button><button id="loopEndDown" class="loop-end-btn">▼</button></span></label>
          <label class="loop-end-label">FO <input type="range" id="fadeOutDuration" min="1" max="10" step="1" value="1" style="width:60px;vertical-align:middle;"> <span id="fadeOutValue">0.1s</span></label>
        </div>
      </div>
    </div>
    <div class="control-group preset-controls">
      <select id="presetSelect"><option value="">プリセット選択...</option></select>
      <div class="preset-btn-stack">
        <button id="presetLoadBtn"><i class="fa-solid fa-folder-open"></i> 読込</button>
        <button id="presetSaveBtn"><i class="fa-solid fa-floppy-disk"></i> 保存</button>
      </div>
      <div class="preset-btn-stack">
        <button id="presetDeleteBtn"><i class="fa-solid fa-trash"></i> 削除</button>
        <button id="publishBtn"><i class="fa-solid fa-globe"></i> 公開</button>
      </div>
      <a href="https://www.notion.so/309e1fdacbe780b9a55ffe34ce04f291" target="_blank" title="Notion 作品リスト" style="color:#999;font-size:16px;margin-left:4px;text-decoration:none;"><i class="fa-solid fa-database"></i></a>
      <button id="copyListBtn" title="作品リストをコピー" style="background:none;border:none;color:#999;font-size:16px;cursor:pointer;padding:2px 4px;"><i class="fa-solid fa-clipboard-list"></i></button>
    </div>
  </div>

  <!-- 設定パネルコンテナ（2列） -->
  <div id="settings-container">
    <!-- カメラ設定パネル（左列） -->
    <div id="camera-panel" class="settings-column">
      <h3>カメラ設定</h3>
      <div id="camera-list">
        <!-- X軸（左右） -->
        <h4 class="setting-category">X (左右) <span id="cameraPosXValue" class="pos-value">-150</span></h4>
        <div class="setting-item dual-range-container">
          <div class="dual-range" data-axis="X" data-min="-500" data-max="500">
            <div class="range-track"></div>
            <div class="range-selected"></div>
            <div class="range-handle min-handle" title="範囲下限"></div>
            <div class="range-handle max-handle" title="範囲上限"></div>
            <div class="current-marker" title="現在位置"></div>
          </div>
          <div class="range-values">
            <span id="cameraRangeXMinVal">-200</span>
            <span id="cameraRangeXMaxVal">200</span>
          </div>
        </div>

        <!-- Y軸（高さ） -->
        <h4 class="setting-category">Y (高さ) <span id="cameraPosYValue" class="pos-value">150</span></h4>
        <div class="setting-item dual-range-container">
          <div class="dual-range" data-axis="Y" data-min="-100" data-max="500">
            <div class="range-track"></div>
            <div class="range-selected"></div>
            <div class="range-handle min-handle" title="範囲下限"></div>
            <div class="range-handle max-handle" title="範囲上限"></div>
            <div class="current-marker" title="現在位置"></div>
          </div>
          <div class="range-values">
            <span id="cameraRangeYMinVal">50</span>
            <span id="cameraRangeYMaxVal">300</span>
          </div>
        </div>

        <!-- Z軸（前後） -->
        <h4 class="setting-category">Z (前後) <span id="cameraPosZValue" class="pos-value">200</span></h4>
        <div class="setting-item dual-range-container">
          <div class="dual-range" data-axis="Z" data-min="-500" data-max="500">
            <div class="range-track"></div>
            <div class="range-selected"></div>
            <div class="range-handle min-handle" title="範囲下限"></div>
            <div class="range-handle max-handle" title="範囲上限"></div>
            <div class="current-marker" title="現在位置"></div>
          </div>
          <div class="range-values">
            <span id="cameraRangeZMinVal">100</span>
            <span id="cameraRangeZMaxVal">300</span>
          </div>
        </div>

        <!-- 中心点 -->
        <h4 class="setting-category">中心点</h4>
        <div class="setting-item">
          <label>X</label>
          <input type="range" id="cameraTargetX" min="-500" max="500" step="5" value="0">
          <span id="cameraTargetXValue">0</span>
        </div>
        <div class="setting-item">
          <label>Y</label>
          <input type="range" id="cameraTargetY" min="-100" max="100" step="5" value="0">
          <span id="cameraTargetYValue">0</span>
        </div>
        <div class="setting-item">
          <label>Z</label>
          <input type="range" id="cameraTargetZ" min="-500" max="500" step="5" value="0">
          <span id="cameraTargetZValue">0</span>
        </div>

        <!-- 下限角度 -->
        <div class="setting-item">
          <label>下限角度</label>
          <input type="range" id="cameraFloorLimit" min="0" max="100" step="1" value="100">
          <span id="cameraFloorLimitValue">100</span>
        </div>

        <!-- 自動切替 -->
        <h4 class="setting-category">自動切替</h4>
        <div class="setting-item">
          <label>
            <input type="checkbox" id="autoCameraEnabled">
            自動カメラ切替
          </label>
        </div>
        <div class="setting-item">
          <label>切替間隔(秒)</label>
          <input type="range" id="autoCameraInterval" min="2" max="20" step="1" value="5">
          <span id="autoCameraIntervalValue">5</span>
        </div>

        <!-- トランジション -->
        <h4 class="setting-category">トランジション</h4>
        <div class="setting-item">
          <label>モード</label>
          <select id="autoCameraMode">
            <option value="continuous">連続（カメラ移動）</option>
            <option value="cut">カット（クロスフェード）</option>
          </select>
        </div>
        <div class="setting-item" id="continuousModeParams">
          <label>移動時間(%)</label>
          <input type="range" id="autoCameraMovePercent" min="10" max="100" step="5" value="50">
          <span id="autoCameraMovePercentValue">50</span>
        </div>
        <div class="setting-item" id="cutModeParams" style="display: none;">
          <label>クロスフェード(秒)</label>
          <input type="range" id="autoCameraCrossfade" min="0.5" max="5" step="0.5" value="1.5">
          <span id="autoCameraCrossfadeValue">1.5</span>
        </div>
      </div>
    </div>

    <!-- エフェクトパネル -->
    <div id="effects-panel" class="settings-column">
      <h3>エフェクト</h3>
      <div id="effects-list">
        <!-- ノート通過時 -->
        <h4 class="setting-category">ノート通過時</h4>
        <div class="setting-item">
          <label>バウンス (0=OFF)</label>
          <input type="range" id="bounceScale" min="0" max="5" step="0.5" value="1">
          <span id="bounceScaleValue">1</span>
        </div>
        <div class="setting-item">
          <label>バウンス時間</label>
          <input type="range" id="bounceDuration" min="0.1" max="0.5" step="0.05" value="0.2">
          <span id="bounceDurationValue">0.2</span>
        </div>
        <div class="setting-item">
          <label>楽器アイコン (0=OFF)</label>
          <input type="range" id="popIconScale" min="0" max="10" step="0.1" value="3">
          <span id="popIconScaleValue">3</span>
        </div>
        <div class="setting-item">
          <label>
            <input type="checkbox" id="rippleEnabled" checked>
            波紋
          </label>
        </div>

        <!-- バスドラ専用 -->
        <h4 class="setting-category">バスドラ専用</h4>
        <div class="setting-item">
          <label>幕フラッシュ</label>
          <input type="range" id="flashEffectIntensity" min="0" max="1" step="0.1" value="0">
          <span id="flashEffectIntensityValue">0</span>
        </div>

        <!-- テンポ専用 -->
        <h4 class="setting-category">テンポ専用</h4>
        <div class="setting-item">
          <label>カメラ回転</label>
          <input type="range" id="beatCameraRotation" min="0" max="1" step="0.1" value="0">
          <span id="beatCameraRotationValue">0</span>
        </div>
        <div class="setting-item">
          <label>背景パルス</label>
          <input type="range" id="beatBackgroundPulse" min="0" max="1" step="0.1" value="0">
          <span id="beatBackgroundPulseValue">0</span>
        </div>
        <div class="setting-item">
          <label>カラーシフト</label>
          <input type="range" id="beatColorShift" min="0" max="1" step="0.1" value="0">
          <span id="beatColorShiftValue">0</span>
        </div>
        <div class="setting-item">
          <label>空間パルス</label>
          <input type="range" id="beatSpacePulse" min="0" max="1" step="0.1" value="0">
          <span id="beatSpacePulseValue">0</span>
        </div>
        <div class="setting-item">
          <label>ストロボ</label>
          <input type="range" id="beatStrobe" min="0" max="1" step="0.1" value="0">
          <span id="beatStrobeValue">0</span>
        </div>

        <!-- 選択式エフェクト -->
        <h4 class="setting-category">選択式（トリガー切替）</h4>
        <div class="setting-item">
          <div class="effect-header">
            <label>カメラ揺れ</label>
            <div class="trigger-radio">
              <label><input type="radio" name="effectCameraShakeTrigger" value="bass" checked>BD</label>
              <label><input type="radio" name="effectCameraShakeTrigger" value="tempo">T</label>
            </div>
          </div>
          <input type="range" id="effectCameraShake" min="0" max="1" step="0.1" value="0">
          <span id="effectCameraShakeValue">0</span>
        </div>
        <div class="setting-item">
          <div class="effect-header">
            <label>カメラズーム</label>
            <div class="trigger-radio">
              <label><input type="radio" name="effectCameraZoomTrigger" value="bass" checked>BD</label>
              <label><input type="radio" name="effectCameraZoomTrigger" value="tempo">T</label>
            </div>
          </div>
          <input type="range" id="effectCameraZoom" min="0" max="1" step="0.1" value="0">
          <span id="effectCameraZoomValue">0</span>
        </div>
        <div class="setting-item">
          <div class="effect-header">
            <label>フラッシュ</label>
            <div class="trigger-radio">
              <label><input type="radio" name="effectFlashTrigger" value="bass" checked>BD</label>
              <label><input type="radio" name="effectFlashTrigger" value="tempo">T</label>
            </div>
          </div>
          <input type="range" id="effectFlash" min="0" max="1" step="0.1" value="0">
          <span id="effectFlashValue">0</span>
        </div>
        <div class="setting-item">
          <div class="effect-header">
            <label>ブラー</label>
            <div class="trigger-radio">
              <label><input type="radio" name="effectBlurTrigger" value="bass" checked>BD</label>
              <label><input type="radio" name="effectBlurTrigger" value="tempo">T</label>
            </div>
          </div>
          <input type="range" id="effectBlur" min="0" max="1" step="0.1" value="0">
          <span id="effectBlurValue">0</span>
        </div>
        <div class="setting-item">
          <div class="effect-header">
            <label>ひび割れ</label>
            <div class="trigger-radio">
              <label><input type="radio" name="effectCrackTrigger" value="bass" checked>BD</label>
              <label><input type="radio" name="effectCrackTrigger" value="tempo">T</label>
            </div>
          </div>
          <input type="range" id="effectCrack" min="0" max="1" step="0.1" value="0">
          <span id="effectCrackValue">0</span>
        </div>
        <div class="setting-item">
          <div class="effect-header">
            <label>グリッチ</label>
            <div class="trigger-radio">
              <label><input type="radio" name="effectGlitchTrigger" value="bass" checked>BD</label>
              <label><input type="radio" name="effectGlitchTrigger" value="tempo">T</label>
            </div>
          </div>
          <input type="range" id="effectGlitch" min="0" max="1" step="0.1" value="0">
          <span id="effectGlitchValue">0</span>
        </div>

      </div>
    </div>
    <!-- 天候エフェクトパネル（右列） -->
    <div id="sunlight-panel" class="settings-column">
      <h3>天候エフェクト</h3>
      <div id="sunlight-list">
        <h4 class="setting-category"><span>ブルーム</span><input type="checkbox" id="bloomEnabled" checked></h4>
        <div class="setting-item">
          <label>強度</label>
          <input type="range" id="bloomStrength" min="0" max="3" step="0.05" value="0">
          <span id="bloomStrengthValue">0</span>
        </div>
        <div class="setting-item">
          <label>半径</label>
          <input type="range" id="bloomRadius" min="0" max="1" step="0.01" value="0.4">
          <span id="bloomRadiusValue">0.4</span>
        </div>
        <div class="setting-item">
          <label><input type="checkbox" id="noteBloomEnabled" checked>ノート発光</label>
        </div>
        <div class="setting-item dual-range-container">
          <label>閾値</label>
          <div class="dual-range" id="bloomThresholdRange" data-min="0" data-max="1">
            <div class="range-track"></div>
            <div class="range-selected"></div>
            <div class="range-handle min-handle" title="下限"></div>
            <div class="range-handle max-handle" title="上限"></div>
            <div class="current-marker" title="現在値"></div>
          </div>
          <div class="range-values">
            <span id="bloomThresholdMinVal">0.8</span>
            <span id="bloomThresholdMaxVal">0.8</span>
          </div>
        </div>
        <h4 class="setting-category"><span>光源</span></h4>
        <div class="setting-item">
          <label>X</label>
          <input type="range" id="sunPosX" min="-200" max="200" step="5" value="50">
          <span id="sunPosXValue">50</span>
        </div>
        <div class="setting-item">
          <label>Y</label>
          <input type="range" id="sunPosY" min="0" max="300" step="5" value="100">
          <span id="sunPosYValue">100</span>
        </div>
        <div class="setting-item">
          <label>Z</label>
          <input type="range" id="sunPosZ" min="-200" max="200" step="5" value="50">
          <span id="sunPosZValue">50</span>
        </div>
        <div class="setting-item">
          <label><input type="checkbox" id="sunLightColorEnabled"> 色</label>
          <input type="color" id="sunLightColor" value="#ffffff">
        </div>
        <div class="setting-item">
          <label>強度</label>
          <input type="range" id="sunLightIntensity" min="0" max="3" step="0.05" value="1">
          <span id="sunLightIntensityValue">1</span>
        </div>
        <h4 class="setting-category"><span>影</span><input type="checkbox" id="shadowEnabled"></h4>
        <div class="setting-item">
          <label>環境</label>
          <label><input type="radio" name="shadowEnvironment" value="indoor" checked> 屋内</label>
          <label><input type="radio" name="shadowEnvironment" value="outdoor"> 屋外</label>
        </div>
        <div class="setting-item">
          <label>濃さ</label>
          <input type="range" id="shadowOpacity" min="0" max="1" step="0.05" value="0.3">
          <span id="shadowOpacityValue">0.3</span>
        </div>
        <div class="setting-item">
          <label><input type="checkbox" id="noteShadowEnabled"> ノートの影</label>
        </div>
        <h4 class="setting-category"><span>レンズフレア</span><input type="checkbox" id="flareEnabled" checked></h4>
        <div class="setting-item">
          <label>強度</label>
          <input type="range" id="lensFlareIntensity" min="0" max="3" step="0.05" value="0">
          <span id="lensFlareIntensityValue">0</span>
        </div>
        <div class="setting-item">
          <label>にじみ</label>
          <input type="range" id="lensFlareBlur" min="0" max="3" step="0.05" value="0">
          <span id="lensFlareBlurValue">0</span>
        </div>
        <h4 class="setting-category"><span>雲の影</span><input type="checkbox" id="cloudShadowEnabled" checked></h4>
        <div class="setting-item">
          <label>濃さ</label>
          <input type="range" id="cloudShadowIntensity" min="0" max="1" step="0.05" value="0">
          <span id="cloudShadowIntensityValue">0</span>
        </div>
        <div class="setting-item">
          <label>速度</label>
          <input type="range" id="cloudShadowSpeed" min="0" max="5" step="0.1" value="1">
          <span id="cloudShadowSpeedValue">1</span>
        </div>
        <div class="setting-item">
          <label>スケール</label>
          <input type="range" id="cloudShadowScale" min="0.5" max="5" step="0.1" value="2">
          <span id="cloudShadowScaleValue">2</span>
        </div>
        <div class="setting-item">
          <label>方向(°)</label>
          <input type="range" id="cloudShadowDirection" min="0" max="360" step="5" value="45">
          <span id="cloudShadowDirectionValue">45</span>
        </div>
        <div class="setting-item">
          <label>日向コントラスト</label>
          <input type="range" id="cloudShadowContrast" min="0" max="3" step="0.05" value="0">
          <span id="cloudShadowContrastValue">0</span>
        </div>
        <h4 class="setting-category"><span>天候</span></h4>
        <div class="setting-item">
          <label>種類</label>
          <select id="weatherType">
            <option value="none">なし</option>
            <option value="rain">雨</option>
            <option value="snow">雪</option>
          </select>
        </div>
        <div class="setting-item">
          <label>量</label>
          <input type="range" id="weatherAmount" min="100" max="500000" step="100" value="3000">
          <span id="weatherAmountValue">3000</span>
        </div>
        <div class="setting-item">
          <label>速度</label>
          <input type="range" id="weatherSpeed" min="0.1" max="15" step="0.1" value="1">
          <span id="weatherSpeedValue">1</span>
        </div>
        <div class="setting-item">
          <label>飛沫</label>
          <input type="range" id="weatherSplash" min="0" max="20" step="1" value="3">
          <span id="weatherSplashValue">3</span>
        </div>
        <div class="setting-item">
          <label>角度(°)</label>
          <input type="range" id="weatherAngle" min="0" max="80" step="1" value="0">
          <span id="weatherAngleValue">0</span>
        </div>
        <div class="setting-item">
          <label>風向(°)</label>
          <input type="range" id="weatherWindDir" min="0" max="360" step="5" value="0">
          <span id="weatherWindDirValue">0</span>
        </div>
        <div class="setting-item">
          <label>範囲</label>
          <input type="range" id="weatherSpread" min="100" max="1000" step="50" value="400">
          <span id="weatherSpreadValue">400</span>
        </div>
        <h4 class="setting-category"><span>雷</span></h4>
        <div class="setting-item">
          <label>頻度</label>
          <input type="range" id="lightningFrequency" min="0" max="30" step="1" value="0">
          <span id="lightningFrequencyValue">0</span>
        </div>
        <div class="setting-item">
          <label>ばらつき</label>
          <input type="range" id="lightningRandomness" min="0" max="1" step="0.05" value="0.5">
          <span id="lightningRandomnessValue">0.5</span>
        </div>
        <div class="setting-item">
          <label>強度</label>
          <input type="range" id="lightningIntensity" min="0.1" max="1" step="0.05" value="0.5">
          <span id="lightningIntensityValue">0.5</span>
        </div>
        <div class="setting-item">
          <label>稲光の色</label>
          <input type="color" id="lightningColor" value="#ffffff">
        </div>
        <div class="setting-item">
          <label>フラッシュ濃度</label>
          <input type="range" id="lightningFlashOpacity" min="0.1" max="1" step="0.05" value="0.5">
          <span id="lightningFlashOpacityValue">0.5</span>
        </div>
        <div class="setting-item">
          <label>フラッシュ減衰</label>
          <input type="range" id="lightningFlashDecay" min="0" max="2" step="0.01" value="0.3">
          <span id="lightningFlashDecayValue">0.3</span>
        </div>
      </div>
    </div>
    <!-- 地形エフェクトパネル（右列） -->
    <div id="terrain-panel" class="settings-column">
      <h3>地形エフェクト</h3>
      <div id="terrain-list">
        <h4 class="setting-category"><span>水面</span><input type="checkbox" id="waterSurfaceEnabled"></h4>
        <div class="setting-item">
          <label>面積</label>
          <input type="range" id="waterSurfaceSize" min="100" max="2000" step="50" value="500">
          <span id="waterSurfaceSizeValue">500</span>
        </div>
        <div class="setting-item">
          <label>スケール</label>
          <input type="range" id="waterSurfaceScale" min="10" max="500" step="1" value="40">
          <span id="waterSurfaceScaleValue">40</span>
        </div>
        <div class="setting-item">
          <label>速度</label>
          <input type="range" id="waterSurfaceSpeed" min="0.1" max="3" step="0.1" value="1">
          <span id="waterSurfaceSpeedValue">1</span>
        </div>
        <div class="setting-item">
          <label>深色</label>
          <input type="color" id="waterSurfaceColor" value="#1a3a6a">
          <label>浅色</label>
          <input type="color" id="waterSurfaceColor2" value="#4a9eed">
        </div>
        <div class="setting-item">
          <label>不透明度</label>
          <input type="range" id="waterSurfaceOpacity" min="0" max="1" step="0.05" value="0.6">
          <span id="waterSurfaceOpacityValue">0.6</span>
        </div>
        <div class="setting-item">
          <label>コースティクス</label>
          <input type="range" id="waterSurfaceCaustic" min="0" max="1" step="0.05" value="0.5">
          <span id="waterSurfaceCausticValue">0.5</span>
        </div>
        <div class="setting-item">
          <label>波高さ</label>
          <input type="range" id="waterSurfaceWaveHeight" min="0" max="20" step="0.5" value="3">
          <span id="waterSurfaceWaveHeightValue">3</span>
        </div>
        <div class="setting-item">
          <label>高度</label>
          <input type="range" id="waterSurfaceHeight" min="-50" max="50" step="1" value="0">
          <span id="waterSurfaceHeightValue">0</span>
        </div>
        <div class="setting-item">
          <label>サンパス強度</label>
          <input type="range" id="waterSunPathIntensity" min="0" max="3" step="0.05" value="0">
          <span id="waterSunPathIntensityValue">0</span>
        </div>
        <div class="setting-item">
          <label>サンパス鋭さ</label>
          <input type="range" id="waterSunPathSharpness" min="2" max="128" step="1" value="32">
          <span id="waterSunPathSharpnessValue">32</span>
        </div>
        <div class="setting-item">
          <label>サンパス色</label>
          <input type="color" id="waterSunPathColor" value="#ffffff">
        </div>
        <div class="setting-item">
          <label>スパークル</label>
          <input type="range" id="waterSparkleIntensity" min="0" max="3" step="0.05" value="0">
          <span id="waterSparkleIntensityValue">0</span>
        </div>
        <div class="setting-item">
          <label>スパークル範囲</label>
          <input type="range" id="waterSparkleRange" min="0" max="1" step="0.05" value="0.5">
          <span id="waterSparkleRangeValue">0.5</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 画像配置パネル（メインエリア上部） -->
  <div id="image-panel">
    <h3>画像設定</h3>
    <div id="image-list">
      <!-- スカイドーム（背景） -->
      <div class="image-section">
        <h4 class="setting-category">背景</h4>
        <div class="image-row">
          <div class="drop-zone" id="skyDomeDropZone">
            <img id="skyDomeImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="skyDomeVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="skyDomeDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="skyDomeImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="skyDome">ライブラリ</button>
            <input type="file" id="skyDomeImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>透明度</label><input type="range" id="skyDomeOpacity" min="0.1" max="1" step="0.05" value="1"><span id="skyDomeOpacityValue">1</span></div>
            <div class="control-row"><label>範囲(度)</label><input type="range" id="skyDomeRange" min="60" max="360" step="1" value="180"><span id="skyDomeRangeValue">180</span></div>
            <div class="control-row"><label>距離</label><input type="range" id="skyDomeRadius" min="100" max="3000" step="50" value="2000"><span id="skyDomeRadiusValue">2000</span></div>
            <div class="control-row"><label>Yオフセット</label><input type="range" id="skyDomeOffsetY" min="-1000" max="1000" step="1" value="0"><span id="skyDomeOffsetYValue">0</span></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="skyDomeChromaColor" value="#00ff00"><input type="range" id="skyDomeChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="skyDomeChromaThresholdValue">0</span></div>
            <button id="skyDomeVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="skyDomeImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- 近景スカイドーム -->
      <div class="image-section">
        <h4 class="setting-category">近景</h4>
        <div class="image-row">
          <div class="drop-zone" id="innerSkyDropZone">
            <img id="innerSkyImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="innerSkyVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="innerSkyDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="innerSkyImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="innerSky">ライブラリ</button>
            <input type="file" id="innerSkyImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>透明度</label><input type="range" id="innerSkyOpacity" min="0.1" max="1" step="0.05" value="1"><span id="innerSkyOpacityValue">1</span></div>
            <div class="control-row"><label>範囲(度)</label><input type="range" id="innerSkyRange" min="60" max="360" step="1" value="180"><span id="innerSkyRangeValue">180</span></div>
            <div class="control-row"><label>距離</label><input type="range" id="innerSkyRadius" min="50" max="2000" step="50" value="500"><span id="innerSkyRadiusValue">500</span></div>
            <div class="control-row"><label>Yオフセット <input type="checkbox" id="innerSkyFollowCameraY" title="カメラY連動"> 連動</label><input type="range" id="innerSkyOffsetY" min="-1000" max="1000" step="1" value="0"><span id="innerSkyOffsetYValue">0</span></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="innerSkyChromaColor" value="#00ff00"><input type="range" id="innerSkyChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="innerSkyChromaThresholdValue">0</span></div>
            <button id="innerSkyVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="innerSkyImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- 床画像 -->
      <div class="image-section">
        <h4 class="setting-category">床1</h4>
        <div class="image-row">
          <div class="drop-zone" id="floorDropZone">
            <img id="floorImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="floorVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="floorDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="floorImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="floor">ライブラリ</button>
            <input type="file" id="floorImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="floorImageSize" min="10" max="10000" step="1" value="300"><span id="floorImageSizeValue">300</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="floorHeight" min="-200" max="200" step="0.1" value="-50"><span id="floorHeightValue">-50</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="floorImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="floorImageOpacityValue">1</span></div>
            <div class="control-row"><label>曲率</label><input type="range" id="floorCurvature" min="0" max="0.0003" step="0.00001" value="0"><span id="floorCurvatureValue">0</span></div>
            <div class="control-row"><label><input type="checkbox" id="floorImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="floorChromaColor" value="#00ff00"><input type="range" id="floorChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="floorChromaThresholdValue">0</span></div>
            <button id="floorVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="floorImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- 床2画像 -->
      <div class="image-section">
        <h4 class="setting-category">床2</h4>
        <div class="image-row">
          <div class="drop-zone" id="floor2DropZone">
            <img id="floor2ImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="floor2VideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="floor2DropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="floor2ImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="floor2">ライブラリ</button>
            <input type="file" id="floor2ImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="floor2ImageSize" min="10" max="10000" step="1" value="300"><span id="floor2ImageSizeValue">300</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="floor2Height" min="-200" max="200" step="0.1" value="-49.9"><span id="floor2HeightValue">-49.9</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="floor2ImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="floor2ImageOpacityValue">1</span></div>
            <div class="control-row"><label>曲率</label><input type="range" id="floor2Curvature" min="0" max="0.0003" step="0.00001" value="0"><span id="floor2CurvatureValue">0</span></div>
            <div class="control-row"><label><input type="checkbox" id="floor2ImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="floor2ChromaColor" value="#00ff00"><input type="range" id="floor2ChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="floor2ChromaThresholdValue">0</span></div>
            <button id="floor2VideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="floor2ImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- 床3画像 -->
      <div class="image-section">
        <h4 class="setting-category">床3</h4>
        <div class="image-row">
          <div class="drop-zone" id="floor3DropZone">
            <img id="floor3ImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="floor3VideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="floor3DropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="floor3ImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="floor3">ライブラリ</button>
            <input type="file" id="floor3ImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="floor3ImageSize" min="10" max="10000" step="1" value="300"><span id="floor3ImageSizeValue">300</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="floor3Height" min="-200" max="200" step="0.1" value="-49.8"><span id="floor3HeightValue">-49.8</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="floor3ImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="floor3ImageOpacityValue">1</span></div>
            <div class="control-row"><label>曲率</label><input type="range" id="floor3Curvature" min="0" max="0.0003" step="0.00001" value="0"><span id="floor3CurvatureValue">0</span></div>
            <div class="control-row"><label><input type="checkbox" id="floor3ImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="floor3ChromaColor" value="#00ff00"><input type="range" id="floor3ChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="floor3ChromaThresholdValue">0</span></div>
            <button id="floor3VideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="floor3ImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

    </div>
    <div id="image-list-row2">
      <!-- 左側面画像 -->
      <div class="image-section">
        <h4 class="setting-category">パネル1</h4>
        <div class="image-row">
          <div class="drop-zone" id="leftWallDropZone">
            <img id="leftWallImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="leftWallVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="leftWallDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="leftWallImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="leftWall">ライブラリ</button>
            <input type="file" id="leftWallImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="leftWallImageSize" min="10" max="1000" step="1" value="300"><span id="leftWallImageSizeValue">300</span></div>
            <div class="control-row"><label>X位置</label><input type="range" id="leftWallImageX" min="-500" max="500" step="1" value="0"><span id="leftWallImageXValue">0</span></div>
            <div class="control-row"><label>Z位置</label><input type="range" id="leftWallImageZ" min="-500" max="500" step="1" value="-150"><span id="leftWallImageZValue">-150</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="leftWallImageY" min="-200" max="200" step="0.1" value="0"><span id="leftWallImageYValue">0</span></div>
            <div class="control-row"><label>Y回転</label><input type="range" id="leftWallImageRotY" min="-180" max="180" step="1" value="0"><span id="leftWallImageRotYValue">0</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="leftWallImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="leftWallImageOpacityValue">1</span></div>
            <div class="control-row"><label><input type="checkbox" id="leftWallImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="leftWallChromaColor" value="#00ff00"><input type="range" id="leftWallChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="leftWallChromaThresholdValue">0</span></div>
            <button id="leftWallVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="leftWallImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- センター画像 -->
      <div class="image-section">
        <h4 class="setting-category">パネル2</h4>
        <div class="image-row">
          <div class="drop-zone" id="centerWallDropZone">
            <img id="centerWallImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="centerWallVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="centerWallDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="centerWallImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="centerWall">ライブラリ</button>
            <input type="file" id="centerWallImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="centerWallImageSize" min="10" max="1000" step="1" value="300"><span id="centerWallImageSizeValue">300</span></div>
            <div class="control-row"><label>X位置</label><input type="range" id="centerWallImageX" min="-500" max="500" step="1" value="0"><span id="centerWallImageXValue">0</span></div>
            <div class="control-row"><label>Z位置</label><input type="range" id="centerWallImageZ" min="-500" max="500" step="1" value="0"><span id="centerWallImageZValue">0</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="centerWallImageY" min="-200" max="200" step="0.1" value="0"><span id="centerWallImageYValue">0</span></div>
            <div class="control-row"><label>Y回転</label><input type="range" id="centerWallImageRotY" min="-180" max="180" step="1" value="0"><span id="centerWallImageRotYValue">0</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="centerWallImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="centerWallImageOpacityValue">1</span></div>
            <div class="control-row"><label><input type="checkbox" id="centerWallImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="centerWallChromaColor" value="#00ff00"><input type="range" id="centerWallChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="centerWallChromaThresholdValue">0</span></div>
            <button id="centerWallVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="centerWallImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- 右側面画像 -->
      <div class="image-section">
        <h4 class="setting-category">パネル3</h4>
        <div class="image-row">
          <div class="drop-zone" id="rightWallDropZone">
            <img id="rightWallImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="rightWallVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="rightWallDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="rightWallImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="rightWall">ライブラリ</button>
            <input type="file" id="rightWallImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="rightWallImageSize" min="10" max="1000" step="1" value="300"><span id="rightWallImageSizeValue">300</span></div>
            <div class="control-row"><label>X位置</label><input type="range" id="rightWallImageX" min="-500" max="500" step="1" value="0"><span id="rightWallImageXValue">0</span></div>
            <div class="control-row"><label>Z位置</label><input type="range" id="rightWallImageZ" min="-500" max="500" step="1" value="150"><span id="rightWallImageZValue">150</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="rightWallImageY" min="-200" max="200" step="0.1" value="0"><span id="rightWallImageYValue">0</span></div>
            <div class="control-row"><label>Y回転</label><input type="range" id="rightWallImageRotY" min="-180" max="180" step="1" value="0"><span id="rightWallImageRotYValue">0</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="rightWallImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="rightWallImageOpacityValue">1</span></div>
            <div class="control-row"><label><input type="checkbox" id="rightWallImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="rightWallChromaColor" value="#00ff00"><input type="range" id="rightWallChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="rightWallChromaThresholdValue">0</span></div>
            <button id="rightWallVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="rightWallImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- 奥側画像 -->
      <div class="image-section">
        <h4 class="setting-category">パネル4</h4>
        <div class="image-row">
          <div class="drop-zone" id="backWallDropZone">
            <img id="backWallImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="backWallVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="backWallDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="backWallImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="backWall">ライブラリ</button>
            <input type="file" id="backWallImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="backWallImageSize" min="10" max="1000" step="1" value="300"><span id="backWallImageSizeValue">300</span></div>
            <div class="control-row"><label>X位置</label><input type="range" id="backWallImageX" min="-500" max="500" step="1" value="0"><span id="backWallImageXValue">0</span></div>
            <div class="control-row"><label>Z位置</label><input type="range" id="backWallImageZ" min="-500" max="500" step="1" value="0"><span id="backWallImageZValue">0</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="backWallImageY" min="-200" max="200" step="0.1" value="0"><span id="backWallImageYValue">0</span></div>
            <div class="control-row"><label>Y回転</label><input type="range" id="backWallImageRotY" min="-180" max="180" step="1" value="90"><span id="backWallImageRotYValue">90</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="backWallImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="backWallImageOpacityValue">1</span></div>
            <div class="control-row"><label><input type="checkbox" id="backWallImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="backWallChromaColor" value="#00ff00"><input type="range" id="backWallChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="backWallChromaThresholdValue">0</span></div>
            <button id="backWallVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="backWallImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- パネル5画像 -->
      <div class="image-section">
        <h4 class="setting-category">パネル5</h4>
        <div class="image-row">
          <div class="drop-zone" id="panel5WallDropZone">
            <img id="panel5WallImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="panel5WallVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="panel5WallDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="panel5WallImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="panel5Wall">ライブラリ</button>
            <input type="file" id="panel5WallImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="panel5WallImageSize" min="10" max="1000" step="1" value="300"><span id="panel5WallImageSizeValue">300</span></div>
            <div class="control-row"><label>X位置</label><input type="range" id="panel5WallImageX" min="-500" max="500" step="1" value="0"><span id="panel5WallImageXValue">0</span></div>
            <div class="control-row"><label>Z位置</label><input type="range" id="panel5WallImageZ" min="-500" max="500" step="1" value="0"><span id="panel5WallImageZValue">0</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="panel5WallImageY" min="-200" max="200" step="0.1" value="0"><span id="panel5WallImageYValue">0</span></div>
            <div class="control-row"><label>Y回転</label><input type="range" id="panel5WallImageRotY" min="-180" max="180" step="1" value="0"><span id="panel5WallImageRotYValue">0</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="panel5WallImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="panel5WallImageOpacityValue">1</span></div>
            <div class="control-row"><label><input type="checkbox" id="panel5WallImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="panel5WallChromaColor" value="#00ff00"><input type="range" id="panel5WallChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="panel5WallChromaThresholdValue">0</span></div>
            <button id="panel5WallVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="panel5WallImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>

      <!-- パネル6画像 -->
      <div class="image-section">
        <h4 class="setting-category">パネル6</h4>
        <div class="image-row">
          <div class="drop-zone" id="panel6WallDropZone">
            <img id="panel6WallImagePreview" class="drop-zone-preview" style="display: none;">
            <video id="panel6WallVideoPreview" class="drop-zone-preview" style="display: none;" muted loop></video>
            <span class="drop-zone-text" id="panel6WallDropZoneText">ドラッグ&ドロップ<br>または</span>
            <label class="file-label" id="panel6WallImageLabel">ファイル選択</label>
            <button class="library-btn" data-slot="panel6Wall">ライブラリ</button>
            <input type="file" id="panel6WallImageInput" accept="image/*,video/mp4,video/webm" style="display:none;">
          </div>
          <div class="image-controls">
            <div class="control-row"><label>サイズ</label><input type="range" id="panel6WallImageSize" min="10" max="1000" step="1" value="300"><span id="panel6WallImageSizeValue">300</span></div>
            <div class="control-row"><label>X位置</label><input type="range" id="panel6WallImageX" min="-500" max="500" step="1" value="0"><span id="panel6WallImageXValue">0</span></div>
            <div class="control-row"><label>Z位置</label><input type="range" id="panel6WallImageZ" min="-500" max="500" step="1" value="0"><span id="panel6WallImageZValue">0</span></div>
            <div class="control-row"><label>高度</label><input type="range" id="panel6WallImageY" min="-200" max="200" step="0.1" value="0"><span id="panel6WallImageYValue">0</span></div>
            <div class="control-row"><label>Y回転</label><input type="range" id="panel6WallImageRotY" min="-180" max="180" step="1" value="0"><span id="panel6WallImageRotYValue">0</span></div>
            <div class="control-row"><label>透明度</label><input type="range" id="panel6WallImageOpacity" min="0.1" max="1" step="0.05" value="1"><span id="panel6WallImageOpacityValue">1</span></div>
            <div class="control-row"><label><input type="checkbox" id="panel6WallImageFlip">反転</label></div>
            <div class="control-row chroma-key-row"><label>透過色</label><input type="color" id="panel6WallChromaColor" value="#00ff00"><input type="range" id="panel6WallChromaThreshold" min="0" max="1" step="0.01" value="0"><span id="panel6WallChromaThresholdValue">0</span></div>
            <button id="panel6WallVideoPause" class="video-pause-btn" style="display:none;" title="動画を一時停止/再生"><i class="fa-solid fa-pause"></i></button>
            <button id="panel6WallImageClear" class="clear-btn-small">クリア</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Three.js キャンバス -->
  <div id="canvas-container">
    <div id="credits-overlay">
      <div id="credits-line1" class="credits-line credits-line-tight" contenteditable="false"></div>
      <div id="credits-line2" class="credits-line" contenteditable="false"></div>
      <div class="credits-line credits-has-prefix" contenteditable="false"><span class="credits-prefix">Comp. </span><span id="credits-line3"></span></div>
      <div class="credits-line credits-has-prefix credits-visible" contenteditable="false"><span class="credits-prefix">Arr. </span><span id="credits-line4">Romashige</span></div>
    </div>
  </div>

  <!-- 表示設定パネル（プレビュー下段・横並び） -->
  <div id="display-settings-panel">
    <h3>表示設定</h3>
    <div class="sections-row">
    <div class="display-section">
      <h4 class="setting-category">ノート</h4>
      <div class="setting-item">
        <label>太さ</label>
        <input type="range" id="noteHeight" min="0.3" max="3" step="0.1" value="0.8">
        <span id="noteHeightValue">0.8</span>
      </div>
      <div class="setting-item">
        <label>奥行き</label>
        <input type="range" id="noteDepth" min="1" max="10" step="0.5" value="1">
        <span id="noteDepthValue">1</span>
      </div>
      <div class="setting-item">
        <label>透明度</label>
        <input type="range" id="noteOpacity" min="0.1" max="1" step="0.05" value="0.85">
        <span id="noteOpacityValue">0.85</span>
      </div>
    </div>
    <div class="display-section">
      <h4 class="setting-category">レイアウト</h4>
      <div class="setting-item">
        <label>トラック間隔</label>
        <input type="range" id="trackSpacing" min="1" max="30" step="0.5" value="6">
        <span id="trackSpacingValue">6</span>
      </div>
      <div class="setting-item">
        <label>時間スケール</label>
        <input type="range" id="timeScale" min="10" max="300" step="5" value="50">
        <span id="timeScaleValue">50</span>
      </div>
      <div class="setting-item">
        <label>縦スケール</label>
        <input type="range" id="pitchScale" min="0.5" max="10" step="0.1" value="1">
        <span id="pitchScaleValue">1</span>
      </div>
      <div class="setting-item">
        <label>高さオフセット</label>
        <input type="range" id="noteYOffset" min="-100" max="200" step="1" value="0">
        <span id="noteYOffsetValue">0</span>
      </div>
    </div>
    <div class="display-section">
      <h4 class="setting-category">タイムライン</h4>
      <div class="setting-item">
        <label>幕の透明度</label>
        <input type="range" id="timelineOpacity" min="0" max="0.5" step="0.05" value="0.25">
        <span id="timelineOpacityValue">0.25</span>
      </div>
      <div class="setting-item">
        <label>X位置</label>
        <input type="range" id="timelineX" min="-500" max="500" step="5" value="0">
        <span id="timelineXValue">0</span>
      </div>
      <div class="setting-item">
        <label>幕の色</label>
        <input type="color" id="timelineColor" value="#ff4444">
      </div>
    </div>
    <div class="display-section">
      <h4 class="setting-category">表示</h4>
      <div class="setting-item">
        <label>背景色（上）</label>
        <input type="color" id="bgColorTop" value="#1a1a2e">
      </div>
      <div class="setting-item">
        <label>背景色（下）</label>
        <input type="color" id="bgColorBottom" value="#0a0a15">
      </div>
      <div class="setting-item">
        <label>中間点</label>
        <input type="range" id="bgGradientMidpoint" min="0" max="100" step="1" value="50">
        <span id="bgGradientMidpointValue">50</span>
      </div>
      <div class="setting-item">
        <button id="bgColorSwap" style="padding: 4px 8px; font-size: 11px;"><i class="fa-solid fa-arrows-up-down"></i> 上下入替</button>
      </div>
    </div>
    <div class="display-section">
      <h4 class="setting-category">スペクトラム</h4>
      <div class="setting-item">
        <label>
          <input type="checkbox" id="audioVisualizerEnabled">
          ON/OFF
        </label>
      </div>
      <div class="setting-item">
        <label>スタイル</label>
        <select id="audioVisualizerStyle">
          <option value="bar">バー</option>
          <option value="wave">ウェーブ</option>
          <option value="dot">ドット</option>
          <option value="mirror">ミラー</option>
        </select>
      </div>
      <div class="setting-item">
        <label>スケール</label>
        <input type="range" id="audioVisualizerScale" min="0.1" max="3" step="0.1" value="1">
        <span id="audioVisualizerScaleValue">1</span>
      </div>
      <div class="setting-item">
        <label>半径</label>
        <input type="range" id="audioVisualizerRadius" min="10" max="200" step="1" value="18">
        <span id="audioVisualizerRadiusValue">18</span>
      </div>
      <div class="setting-item">
        <label>本数</label>
        <input type="range" id="audioVisualizerBars" min="16" max="128" step="1" value="64">
        <span id="audioVisualizerBarsValue">64</span>
      </div>
      <div class="setting-item">
        <label>透明度</label>
        <input type="range" id="audioVisualizerOpacity" min="0" max="1" step="0.05" value="0.9">
        <span id="audioVisualizerOpacityValue">0.9</span>
      </div>
    </div>
    <div class="display-section">
      <h4 class="setting-category">グリッド</h4>
      <div class="setting-item">
        <label>透明度</label>
        <input type="range" id="gridOpacity" min="0" max="1" step="0.1" value="0.5">
        <span id="gridOpacityValue">0.5</span>
      </div>
      <div class="setting-item">
        <label>大きさ</label>
        <input type="range" id="gridSize" min="100" max="2000" step="100" value="500">
        <span id="gridSizeValue">500</span>
      </div>
      <div class="setting-item">
        <label>色</label>
        <input type="color" id="gridColor" value="#444444">
      </div>
    </div>
    <div class="display-section">
      <h4 class="setting-category">クレジット</h4>
      <div class="setting-item credits-row"><label>1行目</label><input type="text" id="creditsLine1" class="credits-input" placeholder="曲名"><input type="number" id="creditsSize1" class="credits-size-input" min="8" max="72" value="16"></div>
      <div class="setting-item credits-row"><label>2行目</label><input type="text" id="creditsLine2" class="credits-input" placeholder="作曲"><input type="number" id="creditsSize2" class="credits-size-input" min="8" max="72" value="16"></div>
      <div class="setting-item credits-row"><label>3行目</label><input type="text" id="creditsLine3" class="credits-input" placeholder="編曲"><input type="number" id="creditsSize3" class="credits-size-input" min="8" max="72" value="16"></div>
      <div class="setting-item credits-row"><label>4行目</label><span style="color:#888;font-size:11px;">Arr. Romashige（固定）</span><input type="number" id="creditsSize4" class="credits-size-input" min="8" max="72" value="16"></div>
      <div class="setting-item">
        <label>色</label>
        <input type="color" id="creditsColor" value="#ffffff">
      </div>
      <div class="setting-item">
        <label>透明度</label>
        <input type="range" id="creditsOpacity" min="0" max="1" step="0.05" value="0.8">
        <span id="creditsOpacityValue">0.8</span>
      </div>
    </div>
    </div>
  </div>

  <!-- トラック情報パネル（右） -->
  <div id="track-panel">
    <h3>トラック情報</h3>
    <div id="track-list"></div>
  </div>

  <!-- プリセット保存モーダル -->
  <div id="presetModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3>プリセット保存</h3>
      <input type="text" id="presetNameInput" placeholder="プリセット名を入力...">
      <div id="presetOverwriteWarning" style="display:none;">同名のプリセットを上書きします</div>
      <div class="modal-buttons">
        <button id="presetSaveConfirm">保存</button>
        <button id="presetSaveCancel">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- 公開モーダル -->
  <div id="publishModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
      <h3>ビューアーを公開</h3>
      <input type="text" id="publishSongName" placeholder="曲名（英数字・ハイフン・アンダースコア）">
      <div id="publishStatus" style="display:none;"></div>
      <div class="modal-buttons">
        <button id="publishConfirm">公開</button>
        <button id="publishCancel">キャンセル</button>
      </div>
    </div>
  </div>

  <!-- メディアライブラリモーダル -->
  <div id="mediaLibraryModal" class="modal-overlay modal-centered" style="display:none;">
    <div class="modal-content media-library-modal">
      <h3>メディアライブラリ</h3>
      <div id="mediaLibraryGrid" class="media-grid"></div>
      <div class="modal-buttons">
        <button id="mediaLibraryCancel">閉じる</button>
      </div>
    </div>
  </div>

  <!-- ライブラリ読み込み -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tonejs/midi@2.0.28/build/Midi.min.js"></script>

  <script src="src/presetManager.js?v=20260217c"></script>
  <script src="src/viewerExport.js?v=20260217k"></script>
  <script type="module" src="src/main.js?v=20260218a"></script>
</body>
</html>
